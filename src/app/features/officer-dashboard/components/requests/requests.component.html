<div class="requests-container">
  <h2>requests</h2>

  <div class="table-container mat-elevation-z2">
    <table mat-table [dataSource]="dataSource">
      <!-- Username Column -->
      <ng-container matColumnDef="username">
        <th mat-header-cell *matHeaderCellDef>Username</th>
        <td mat-cell *matCellDef="let element">{{element.username || 'loading...'}}</td>
      </ng-container>

      <!-- Address Column -->
      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef>Address</th>
        <td mat-cell *matCellDef="let element"
            [matTooltip]="getAddressTooltip(element)"
            matTooltipPosition="above">
          {{element.address?.state || 'Unknown'}}
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let element">
          <span class="status-badge" [ngClass]="element.status.toLowerCase()">
            {{element.status}}
          </span>
        </td>
      </ng-container>

      <!-- Created At Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Created At</th>
        <td mat-cell *matCellDef="let element">{{formatDate(element.createdAt)}}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <div class="actions-container">
            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Actions">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="handleAction(element, 'approve')"
                      [disabled]="element.status !== 'pending'" class="approve-btn">
                <mat-icon>check_circle</mat-icon>
                <span>Approve</span>
              </button>
              <button mat-menu-item (click)="handleAction(element, 'reject')"
                      [disabled]="element.status !== 'pending'" class="reject-btn">
                <mat-icon>cancel</mat-icon>
                <span>Reject</span>
              </button>

            </mat-menu>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- <div class="loading-shade" *ngIf="isLoading">
      <mat-spinner></mat-spinner>
    </div> -->

    <div class="pagination-container">
      <div class="items-per-page">
        Items per page:
        <select (change)="loadRequests()" [(ngModel)]="pageSize">
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
      </div>

      <div class="pagination-info">
        {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalItems) }} of {{ totalItems }}
      </div>

      <div class="pagination-controls">
        <button mat-icon-button [disabled]="currentPage === 1" (click)="loadRequests(currentPage - 1)">
          <mat-icon>navigate_before</mat-icon>
        </button>
        <button mat-icon-button [disabled]="currentPage * pageSize >= totalItems" (click)="loadRequests(currentPage + 1)">
          <mat-icon>navigate_next</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>